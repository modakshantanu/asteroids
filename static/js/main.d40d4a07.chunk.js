(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{13:function(t,e,i){t.exports=i(27)},19:function(t,e,i){},27:function(t,e,i){"use strict";i.r(e);var s=i(1),n=i.n(s),a=i(9),r=i.n(a),h=(i(19),i(2)),o=i(0),l=i(12),u=i(10),d=i(3),c=i(11),p=87,v=65,f=68,m=32,y=function(){function t(){Object(h.a)(this,t),this.pressedKeys={left:0,right:0,forward:0,space:0}}return Object(o.a)(t,[{key:"bindKeys",value:function(){window.addEventListener("keyup",this.handleKeys.bind(this,!1)),window.addEventListener("keydown",this.handleKeys.bind(this,!0))}},{key:"unbindKeys",value:function(){window.removeEventListener("keyup",this.handleKeys),window.removeEventListener("keydown",this.handleKeys)}}]),Object(o.a)(t,[{key:"handleKeys",value:function(t,e){var i=this.pressedKeys;switch(e.keyCode){case v:i.left=t;break;case f:i.right=t;break;case p:i.forward=t;break;case m:i.space=t}this.pressedKeys=i}}]),t}(),g=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(h.a)(this,t),this.x=e,this.y=i}return Object(o.a)(t,[{key:"add",value:function(e){return new t(this.x+e.x,this.y+e.y)}},{key:"dot",value:function(e){return new t(e*this.x,e*this.y)}},{key:"rotate",value:function(e){var i=Math.cos(e),s=Math.sin(e);return new t(i*this.x-s*this.y,s*this.x+i*this.y)}}]),t}(),w={canvasBounds:{width:500,height:500},gameBounds:{width:1e3,height:1e3},minimapBounds:{width:100,height:100}};function b(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:w.gameBounds,i=e.width,s=e.height,n=t.x,a=t.y;return n>i&&(n-=i),n<0&&(n+=i),a>s&&(a-=s),a<0&&(a+=s),new g(n,a)}function x(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function k(t,e){var i=t.x,s=t.y,n=e*Math.PI/180,a=Math.cos(n),r=Math.sin(n);return{x:a*i-r*s,y:r*i+a*s}}function M(t,e){var i=w.canvasBounds,s=i.width,n=i.height,a=t.x,r=t.y;return b({x:a=a-e.x+s/2,y:r=r-e.y+n/2},w.gameBounds)}var B=function(){function t(e){Object(h.a)(this,t),this.pos=e.pos,this.vel=e.vel||new g(0,0),this.radius=14.5,this.angle=e.angle||0,this.lastFiredTime=new Date}return Object(o.a)(t,[{key:"render",value:function(t){if(t.input.pressedKeys.left&&(this.angle-=7),t.input.pressedKeys.right&&(this.angle+=7),t.input.pressedKeys.forward){var e=this.angle-90;this.vel=this.vel.add(new g(.2,0).rotate(e*Math.PI/180))}this.pos=this.pos.add(this.vel),this.pos=b(this.pos),this.angle>360&&(this.angle-=360),this.angle<0&&(this.angle+=360),this.vel=this.vel.dot(.98);var i=this.pos;t.shipCam&&(i=M(i,i));var s=t.context;s.save(),s.translate(.5,.5),s.translate(i.x,i.y),s.rotate(this.angle*Math.PI/180),s.strokeStyle="#000000",s.fillStyle="#888888",s.lineWidth=.5,s.beginPath(),s.moveTo(0,0),s.lineTo(12.49,7.21),s.lineTo(0,-14.44),s.lineTo(-12.49,7.21),s.closePath(),s.fill(),s.stroke(),s.restore()}},{key:"getHitbox",value:function(){var t=this,e=[];return e.push({x:12.49,y:7.21}),e.push({x:0,y:-14.44}),e.push({x:-12.49,y:7.21}),e=e.map(function(e){var i=k(e,t.angle),s=i.x,n=i.y;return{x:s+t.pos.x,y:n+t.pos.y}})}}]),t}(),E=i(20);function O(t,e){return t+Math.random()*(e-t)}function C(t,e){return 0!==E(t,e).length}var S=function(t){var e=t*Math.PI/180;return{x:Math.cos(e),y:Math.sin(e)}},j=function(){function t(e){if(Object(h.a)(this,t),this.pos=e.pos||new g(0,0),this.r=e.r||0,this.vel=e.vel||new g(0,0),this.dr=e.dr||0,this.distances=e.vertexDistances||[-1],this.sizeCategory=e.sizeCategory||3,this.delete=!1,1===this.distances.length){this.distances.splice(0,1);for(var i=10*this.sizeCategory,s=0;s<6;s++){var n=this.sizeCategory*O(-2,2);this.distances.push(Math.round(i+n))}}this.points=this.distances.map(function(t,e){var i=S(60*e);return{x:t*i.x,y:t*i.y}}),this.radius=this.distances.reduce(function(t,e){return Math.max(t,e)})}return Object(o.a)(t,[{key:"render",value:function(t,e){this.pos=this.pos.add(this.vel),this.r+=this.dr,this.pos=b(this.pos);var i=this.pos;t.shipCam&&(i=M(i,e));for(var s="M".concat(this.points[0].x," ").concat(this.points[0].y," "),n=1;n<this.points.length;n++)s+="L ".concat(this.points[n].x," ").concat(this.points[n].y," ");s+="Z";var a=t.context;a.save(),a.translate(.5,.5),a.translate(i.x,i.y),a.rotate(this.r*Math.PI/180),a.strokeStyle="#000000",a.fillStyle="#ffffff",a.lineWidth=1;var r=new Path2D(s);a.stroke(r),a.restore()}},{key:"getHitbox",value:function(){var t=this;return this.points.map(function(e){var i=k(e,t.r),s=i.x,n=i.y;return{x:s+t.pos.x,y:n+t.pos.y}})}}]),t}(),I=function(){function t(e){Object(h.a)(this,t),this.pos=e.pos||new g(0,0),this.vel=e.vel||new g,this.lifeTime=e.lifeTime||200,this.delete=0,this.radius=2}return Object(o.a)(t,[{key:"render",value:function(t,e){this.pos=b(this.pos.add(this.vel));var i=this.pos;t.shipCam&&(i=M(i,e)),this.lifeTime--,0===this.lifeTime&&(this.delete=!0);var s=t.context;s.save(),s.translate(.5,.5),s.beginPath(),s.fillStyle="#ff0000",s.lineWidth=.5,s.arc(i.x,i.y,2,0,2*Math.PI),s.fill(),s.restore()}}]),t}();var P=function(){function t(){Object(h.a)(this,t)}return Object(o.a)(t,[{key:"render",value:function(t,e,i){var s,n,a=t.minimapContext;a.save(),a.fillStyle="#fff",a.fillRect(0,0,w.minimapBounds.width,w.minimapBounds.height),a.translate(.5,.5),a.fillStyle="#888",i.forEach(function(t){a.beginPath(),s=t.pos.x/w.gameBounds.width*w.minimapBounds.width,n=t.pos.y/w.gameBounds.height*w.minimapBounds.height,a.arc(s,n,t.sizeCategory,0,2*Math.PI),a.fill()}),a.fillStyle="red",s=e.pos.x/w.gameBounds.width*w.minimapBounds.width,n=e.pos.y/w.gameBounds.height*w.minimapBounds.height,a.beginPath(),a.arc(s,n,2,0,2*Math.PI),a.fill(),a.restore()}}]),t}(),K={RUNNING:1,OVER:2},T=null,L=function(t){function e(t){var i;return Object(h.a)(this,e),(i=Object(l.a)(this,Object(u.a)(e).call(this,t))).state={input:new y,context:null,minimapContext:null,score:0,level:1,shipCam:!0},i.draw=i.draw.bind(Object(d.a)(i)),i.resetHandler=i.resetHandler.bind(Object(d.a)(i)),i.initLevel=i.initLevel.bind(Object(d.a)(i)),i.debugFunc=i.debugFunc.bind(Object(d.a)(i)),i.gameStatus=K.RUNNING,i.asteroids=[],i.bullets=[],i.minimap=new P,i.initLevel(1),i}return Object(c.a)(e,t),Object(o.a)(e,[{key:"componentDidMount",value:function(){this.state.input.bindKeys();var t=this.refs.canvas.getContext("2d"),e=this.refs.minimap.getContext("2d");this.setState({context:t,minimapContext:e}),T=requestAnimationFrame(this.draw);var i=document.createElement("canvas");i.width=w.gameBounds.width,i.height=w.gameBounds.height;var s=i.getContext("2d");s.fillStyle="#000";for(var n=0;n<w.canvasBounds.width;n+=20)for(var a=0;a<w.canvasBounds.height;a+=20)s.fillRect(n,a,1,1);this.back=i}},{key:"resetHandler",value:function(){cancelAnimationFrame(T),this.setState({score:0,level:1}),this.initLevel(1),this.gameStatus=K.RUNNING,this.refs.reset.blur(),T=requestAnimationFrame(this.draw)}},{key:"initLevel",value:function(t){this.ship=new B({pos:new g(50,50)}),this.asteroids=[];for(var e=0;e<t;e++){var i=O(1,3),s=O(-2,2),n=new g(O(200,w.gameBounds.width),O(200,w.gameBounds.width)),a=new g(i,0).rotate(O(0,360));this.asteroids.push(new j({pos:n,vel:a,dr:s}))}this.bullets=[]}},{key:"draw",value:function(){var t,e,i=this,s=this.state.context;(s.fillStyle="#fff",s.font="30px Arial",s.fillRect(0,0,w.canvasBounds.width,w.canvasBounds.height),function(t,e,i){var s,n;s=20-i.x%20,n=20-i.y%20,t.drawImage(e,s,n)}(s,this.back,this.ship.pos),this.state.input.pressedKeys.space&&(new Date).getTime()-this.ship.lastFiredTime>300)&&(this.ship.lastFiredTime=new Date,t=5*Math.sin(this.ship.angle*Math.PI/180)+this.ship.vel.x,e=-5*Math.cos(this.ship.angle*Math.PI/180)+this.ship.vel.y,this.bullets.push(new I({pos:this.ship.pos,vel:new g(t,e)})));this.bullets.forEach(function(t,e,s){i.asteroids.forEach(function(n,a,r){if(x(t.pos,n.pos)<t.radius+n.radius&&C([t.pos],n.getHitbox())){s.splice(e,1);var h=n.sizeCategory-1;if(h>0){var o=n.vel.rotate((30*Math.random()+30)*Math.PI/180).dot(1.2);r.push(new j({pos:n.pos,vel:o,dr:6*Math.random()-3,sizeCategory:h})),o=n.vel.rotate(-(30*Math.random()+30)*Math.PI/180).dot(1.2),r.push(new j({pos:n.pos,vel:o,dr:6*Math.random()-3,sizeCategory:h}))}r.splice(a,1),i.setState(function(t){return{score:t.score+10}})}})}),this.asteroids.forEach(function(t,e,n){x(i.ship.pos,t.pos)<i.ship.radius+t.radius&&C(i.ship.getHitbox(),t.getHitbox())&&(i.gameStatus=K.OVER,s.fillStyle="#000",s.fillText("Game Over",200,200))}),this.ship.render(this.state),this.asteroids.forEach(function(t,e,s){t.delete?s.splice(e,1):t.render(i.state,i.ship.pos)}),this.bullets.forEach(function(t,e,s){t.delete?s.splice(e,1):t.render(i.state,i.ship.pos)}),0===this.asteroids.length&&(this.initLevel(this.state.level+1),this.setState(function(t){return{level:t.level+1}})),this.minimap.render(this.state,this.ship,this.asteroids),this.gameStatus===K.RUNNING&&(T=requestAnimationFrame(this.draw))}},{key:"componentWillUnmount",value:function(){this.state.input.unbindKeys()}},{key:"debugFunc",value:function(){}},{key:"cameraHandler",value:function(){this.setState(function(t){return{shipCam:!t.shipCam}}),this.refs.cam.blur()}},{key:"render",value:function(){return n.a.createElement("div",null,n.a.createElement("h1",null,"Asteroids!"),n.a.createElement("canvas",{ref:"canvas",id:"canvas",width:w.canvasBounds.width,height:w.canvasBounds.height}),n.a.createElement("div",{id:"gameStats"},n.a.createElement("button",{ref:"reset",onClick:this.resetHandler},"Reset"),n.a.createElement("div",{id:"Score"},"Score: ",this.state.score),n.a.createElement("div",{id:"level"},"Level: ",this.state.level),n.a.createElement("button",{ref:"debug",onClick:this.debugFunc},"Debug"),n.a.createElement("br",null),n.a.createElement("canvas",{ref:"minimap",id:"minimap",width:"100",height:"100"})))}}]),e}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(L,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})}},[[13,1,2]]]);
//# sourceMappingURL=main.d40d4a07.chunk.js.map